<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://schollz.com/index.xml" />
<meta name="robots" content="all,follow">

<title>üèä Worker Pool in Go | Zack Scholl</title>

<meta name="description" content="A simple pattern to get started using worker pools with Golang.">
<meta name="image" content="/img/golangworker.jpg">

<meta itemprop="name" content="üèä Worker Pool in Go | Zack Scholl">
<meta itemprop="description" content="A simple pattern to get started using worker pools with Golang.">
<meta itemprop="image" content="/img/golangworker.jpg">

<meta name="twitter:card" content="In Go there is one boilerplate that I use more than any other - the worker pool. The worker pool that I like most is the one presented by Go By Example which I modify each time I use.
Since I like to have my own control over the worker pool I write the code each time. Each time it requires implementation of a worker function, and the job and result types.">
<meta name="twitter:title" content="üèä Worker Pool in Go | Zack Scholl">
<meta name="twitter:description" content="A simple pattern to get started using worker pools with Golang.">
<meta name="twitter:site" content="https://schollz.com/blog/worker-pool/">
<meta name="twitter:creator" content="@yakczar">
<meta name="twitter:image:src" content="/img/golangworker.jpg">

<meta name="og:title" content="üèä Worker Pool in Go | Zack Scholl">
<meta name="og:description" content="A simple pattern to get started using worker pools with Golang.">
<meta name="og:image" content="/img/golangworker.jpg">
<meta name="og:url" content="https://schollz.com/blog/worker-pool/">
<meta name="og:site_name" content="üèä Worker Pool in Go | Zack Scholl">
<meta name="og:locale" content="en_US">
<meta name="og:type" content="website">
<link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="/img/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
<link rel="manifest" href="/img/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#161616">
<meta name="msapplication-TileImage" content="/img/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#161616">
<link rel="stylesheet" type="text/css" href="/css/base.css">

    
    
    <script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
</head>

<body>
    <div class="holygrail-body">
        
        <main id="maincontent" class="holygrail-content m1">
            
            
<div class="writing">
    <div style="position: relative;text-align: center;color:
black;

-webkit-text-fill-color:
white;

-webkit-text-stroke-width: 0.5px;

-webkit-text-stroke-color:
black;font-size: 120%;

font-weight: bold;">
        <h1 style="position:absolute;top:8px;right:16px;"><a href="/blog" style="font-weight:bold;  text-decoration: none;">/blog</a></h1>
        <img class="titleimage" src="/img/golangworker.jpg">
    </div>
    
    
    <h1 class="title">üèä Worker Pool in Go</h1>
    
    <p class="description">A simple pattern to get started using worker pools with Golang.</p>
    <p>In Go there is one boilerplate that I use more than any other - the worker pool. The worker pool that I like most is the one presented by <a href="https://gobyexample.com/worker-pools">Go By Example</a> which I modify each time I use.</p>
<p>Since I like to have my own control over the worker pool I write the code each time. Each time it requires implementation of a worker function, and the job and result types. However, to make it easier, I&rsquo;ve boiled it down to a simple copy and paste with only <strong>5 steps of user input</strong>:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-golang" data-lang="golang"><span style="color:#09f;font-style:italic">// step 1
</span><span style="color:#09f;font-style:italic">// specify the number of jobs
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">var</span> numJobs = <span style="color:#f60">1</span>

<span style="color:#09f;font-style:italic">// step 2
</span><span style="color:#09f;font-style:italic">// specify the job and result type
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">type</span> job <span style="color:#069;font-weight:bold">struct</span> {

}
<span style="color:#069;font-weight:bold">type</span> result <span style="color:#069;font-weight:bold">struct</span> {
	err <span style="color:#078;font-weight:bold">error</span>
}

jobs <span style="color:#555">:=</span> <span style="color:#366">make</span>(<span style="color:#069;font-weight:bold">chan</span> jobs, numJobs)
results <span style="color:#555">:=</span> <span style="color:#366">make</span>(<span style="color:#069;font-weight:bold">chan</span> result, numJobs)
runtime.<span style="color:#c0f">GOMAXPROCS</span>(runtime.<span style="color:#c0f">NumCPU</span>())
<span style="color:#069;font-weight:bold">for</span> i <span style="color:#555">:=</span> <span style="color:#f60">0</span>; i &lt; runtime.<span style="color:#c0f">NumCPU</span>(); i<span style="color:#555">++</span> {
	<span style="color:#069;font-weight:bold">go</span> <span style="color:#069;font-weight:bold">func</span>(jobs <span style="color:#555">&lt;-</span><span style="color:#069;font-weight:bold">chan</span> job, results <span style="color:#069;font-weight:bold">chan</span><span style="color:#555">&lt;-</span> result) {
		<span style="color:#069;font-weight:bold">for</span> j <span style="color:#555">:=</span> <span style="color:#069;font-weight:bold">range</span> jobs {
			<span style="color:#09f;font-style:italic">// step 3
</span><span style="color:#09f;font-style:italic"></span>			<span style="color:#09f;font-style:italic">// specify the work for the worker 
</span><span style="color:#09f;font-style:italic"></span>			<span style="color:#069;font-weight:bold">var</span> err <span style="color:#078;font-weight:bold">error</span> 				
			results <span style="color:#555">&lt;-</span> result{
				err: err,
			}
		}
	}(jobs,results)
}

<span style="color:#09f;font-style:italic">// step 4
</span><span style="color:#09f;font-style:italic">// specify how to push out jobs
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">for</span> i<span style="color:#555">:=</span><span style="color:#f60">0</span>;i&lt;numJobs;i<span style="color:#555">++</span>{
	jobs <span style="color:#555">&lt;-</span> job{}
}
<span style="color:#366">close</span>(jobs)

<span style="color:#09f;font-style:italic">// step 5
</span><span style="color:#09f;font-style:italic">// do something with results
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">for</span> i<span style="color:#555">:=</span><span style="color:#f60">0</span>;i&lt;numJobs;i<span style="color:#555">++</span>{
	<span style="color:#555">&lt;-</span>results
}
</code></pre></div><p>The main change is that I&rsquo;ve created a <code>job</code> and a <code>result</code> type which you can populate with anything you want exchanged between the worker and main thread. Also I use <code>runtime</code> to automatically utilize all the porcessors.</p>
<p>Hope that might work for you too!</p>

    <p class="muted">
        <postamble datetime=2020-02-19 2018-09-04>February 19, 2020</postamble>
</div>
‚Üê <a href="https://schollz.com/blog/pottery/">‚ö±Ô∏è Programming to register for pottery</a>



            <footer>Filed in <a href="/blog">Blog</a>. 2019.
	<div class="fr">
	<a href="/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss">
                <path d="M4 11a9 9 0 0 1 9 9"></path>
                <path d="M4 4a16 16 0 0 1 16 16"></path>
                <circle cx="5" cy="19" r="1"></circle>
            </svg></a>
        <a href="https://instagram.com/yakczar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram">
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
            </svg></a>&nbsp;
        <a href="https://twitter.com/yakczar"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter">
                <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
            </svg></a>
	</div>

</footer>

        </main>
        <nav class="holygrail-left"><div class="mobile m1">
    <div class="topnav" id="myTopnav">
        
        
        
        <a class="active" style="padding-left:0;">Zack Scholl | Blog</a>
        
        <a href='/academic'>Academic</a>
        
        <a href='/painting'>Painting</a>
        
        <a href='/music'>Music</a>
        
        <a href='/newyorker'>New Yorker</a>
        
        <a href='/blog'>Blog</a>
        
        <a href='/websites'>Websites</a>
        
        <a href='/raspberrypi'>Raspberry Pi</a>
        
        <a href='/books'>Books</a>
        
        <a href='/podcasts'>Podcasts</a>
        
        <a href='/contact'>Contact</a>
        
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </a>
    </div>
</div>
<div class="desktop mt1">
    <div class="list tr pr1">
        
         
        
        <ul style="margin-top:0em;">
            
            <li style="padding-right:0.5em;"><a href="/academic">Academic</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/painting">Painting</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/music">Music</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/newyorker">New Yorker</a>
                
            </li>
            
            <li style="padding-right:0.5em;; padding-top:0.5em;padding-bottom:0.5em;"><b><a href="/blog">Blog</a></b>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/websites">Websites</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/raspberrypi">Raspberry Pi</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/books">Books</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/podcasts">Podcasts</a>
                
            </li>
            
            <li style="padding-right:0.5em;"><a href="/contact">Contact</a>
                
            </li>
            
        </ul>
        <input type="text" id="searchfield" onkeydown="doSearch()" style="margin-top: 1em; width:8em;" placeholder="Search... ">
    </div>
</div>
<script>
function myFunction() {
    var x = document.getElementById("myTopnav");
    if (x.className === "topnav") {
        x.className += " responsive";
    } else {
        x.className = "topnav";
    }
}
</script>

<script>




function debounce(func, wait, immediate) {
    var timeout;
    return function() {
        var context = this,
            args = arguments;
        var later = function() {
            timeout = null;
            if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
    };
};

var doSearch = debounce(function() {
    
    var searchTerm = document.getElementById("searchfield").value;
    var t0 = performance.now();
    var xhr = new XMLHttpRequest();
    xhr.open('POST', 'https://pagesearch.schollz.com/search');
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
        if (xhr.status === 200) {
            var userInfo = JSON.parse(xhr.responseText);
            data = JSON.parse(xhr.responseText);
            var timeTaken = Math.round(performance.now() - t0);
            var numEntries = data["pages"].length;
            html = `<p>Found ${numEntries} results in ${timeTaken} ms for '${searchTerm}'</p>`;
            data["pages"].forEach(function(entry) {
                html += `<p class="searchresult"><a href="${entry["id"]}">${entry["meta"]["title"]}</a><blockquote>${entry["data"]}</blockquote></p>`;
            });
            document.getElementById("maincontent").innerHTML = html;
        }
    };
    xhr.send(JSON.stringify({
        url: 'https://yakczar.com/searchindex.json',
        search: searchTerm
    }));
}, 250);
</script>
<style>
.topnav {
    overflow: hidden;
}

.topnav img {
    width: 48px;
    height: 48px;
    float: left;
    padding-right: 1em;
}

.topnav span {
    float: left;
    display: block;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
}

.topnav a {
    float: left;
    display: block;
    text-align: center;
    padding: 0.4em 0.4em;
    text-decoration: none;
    font-size: 0.9em;
}

.topnav a:hover {
    background-color: #ddd;
    color: black;
}

.topnav a:nth-child(n+3) {
    display: none;
}

.topnav a.icon {
    float: right;
    display: block;
}

.topnav.responsive {
    position: relative;
}

.topnav.responsive .icon {
    position: absolute;
    right: 0;
    top: 0;
}

.topnav.responsive a {
    float: none;
    display: block;
    text-align: left;
}
</style>
        </nav>
        
    </div>
    
    
    <script src="/js/quicklink.umd.js"></script>
    <script>
    function ready(fn) {
        quicklink({ priority: 'high' });
        if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
            var elements = document.querySelectorAll("img");
            Array.prototype.forEach.call(elements, function(el, i) {
                if (el.getAttribute("alt")) {
                    const caption = document.createElement('figcaption');
                    var node = document.createTextNode(el.getAttribute("alt"));
                    caption.appendChild(node);
                    const wrapper = document.createElement('figure');
                    wrapper.className = 'image';
                    el.parentNode.insertBefore(wrapper, el);
                    el.parentNode.removeChild(el);
                    wrapper.appendChild(el);
                    wrapper.appendChild(caption);
                    console.log(el);
                    console.log(el.outerHTML)
                }
            });
        } else {
            document.addEventListener('DOMContentLoaded', fn);
        }
    }
    window.onload = ready;
    </script>
</body>

</html>